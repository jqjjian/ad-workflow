---
description: 
globs: 
alwaysApply: true
---
# 数据库规范

本文档定义了广告工作流项目的数据库设计、访问和管理规范，确保数据一致性、安全性和性能。

## 数据模型设计
- 使用 Prisma Schema 作为数据模型的唯一源头
- 表名使用单数形式（如 `User` 而非 `Users`）
- 字段名使用 camelCase 命名规则
- 主键默认使用 `id` 字段，类型为 UUID 或自增整数
- 包含创建和更新时间戳（`createdAt`, `updatedAt`）
- 使用外键约束维护数据完整性
- 合理设置字段类型和长度限制

## 数据库迁移
- 所有数据库变更通过 Prisma Migrate 实现
- 迁移文件应有描述性命名，包含变更日期和目的
- 迁移应是幂等的，可重复应用而不产生错误
- 重大变更（如删除表或列）需保留数据备份
- 开发环境可重置数据库，生产环境只能应用增量迁移

## 数据访问模式
- 使用 Prisma Client 作为数据访问层
- 复杂查询封装为服务函数或 Repository 模式
- 避免在应用层拼接 SQL 语句，防止 SQL 注入
- 使用事务保证多操作的原子性
- 敏感查询参数应使用参数化查询方式

## 性能优化
- 为频繁查询的字段创建适当索引
- 大表使用分页查询，避免一次性获取过多数据
- 使用适当的查询缓存策略减少数据库负载
- 监控慢查询并优化查询计划
- 定期分析表结构和数据分布，优化数据模型

## 数据安全
- 敏感数据（如密码）必须加密存储
- 使用最小权限原则分配数据库访问权限
- 数据库凭证避免硬编码，使用环境变量或安全存储
- 生产环境数据库需启用防火墙限制访问
- 定期备份数据库并验证恢复过程

## 数据管理
- 开发使用本地数据库，测试和生产使用独立环境
- 使用种子数据初始化开发和测试环境
- 建立数据清理策略，定期归档或删除过期数据
- 维护数据字典，记录表和字段的业务含义
- 对数据库变更进行版本控制和审计记录
