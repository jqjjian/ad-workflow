---
description: 
globs: 
alwaysApply: true
---
# 开发运维规范

本文档定义了广告工作流项目的开发运维规范，包括部署、容器化和服务器配置等方面的最佳实践。

## Docker 容器规范
- 使用多阶段构建减小镜像体积
- 基础镜像使用官方稳定版本，避免使用 latest 标签
- 明确指定依赖版本，确保构建一致性
- 容器以非 root 用户运行，提高安全性
- 镜像中不包含敏感信息，通过环境变量或挂载卷提供

## 部署流程
- 使用自动化脚本执行构建和部署流程
- 部署前执行自动化测试确保质量
- 使用环境变量区分不同环境的配置
- 保留部署历史记录和回滚机制
- 采用蓝绿部署或滚动更新策略减少停机时间

## 服务器配置
- 服务器配置应通过代码管理，避免手动修改
- Nginx 配置应优化性能和安全性
- 合理配置缓存策略提高响应速度
- 启用 HTTPS 并配置适当的安全头信息
- 监控服务器资源使用情况，及时扩容

## 监控与日志
- 收集关键业务指标和系统性能指标
- 集中管理日志并设置适当的日志级别和轮转策略
- 设置关键指标的告警阈值
- 定期审查日志发现潜在问题
- 记录详细的错误信息便于排查问题

## 安全实践
- 定期更新依赖和系统补丁
- 限制网络访问，仅开放必要端口
- 使用防火墙和网络隔离保护敏感服务
- 定期备份数据并测试恢复流程
- 对敏感操作启用审计日志

## CI/CD 配置
- 使用持续集成确保代码质量
- 自动化测试覆盖核心功能
- 持续部署到测试环境验证功能
- 生产环境部署需人工审核和批准
- 部署失败时自动回滚到上一稳定版本
